<?php
session_start();  // is needed with no PHP Generator Scriptcase
if (!function_exists('simplexml_load_file')) {
	die('simpleXML functions are not available.');
}
if (ini_get("allow_url_fopen") == 1)	{
}
else	{	
	die('allow_url_fopen does not work.'); 	
}
$filesPath = '/home/admin/whois_file/';
$dataFile = 'email_confirmation_data.xml';
$inputdomain = 'webhostingtech.nl';
$url1a = "http://whois.hostingtool.nl/whois_compose_data/index.php?domain=$inputdomain&format=xml&type=1";
$url1b = "http://whois.hostingtool.nl/".$dataFile;

if (file_exists($filesPath.$dataFile) and false)	{ // skipping initial testing
	$xml1 = simplexml_load_file($filesPath.$dataFile) or die("Cannot load xml1 from path,");
}
elseif (file_exists($dataFile))	{
	$xml1 = simplexml_load_file($dataFile) or die("Cannot load xml1 from same folder.");
}
elseif (@get_headers($url1a) and false)	{ // skipping complex application to compose
	$xml1 = simplexml_load_file($url1a, "SimpleXMLElement", LIBXML_NOCDATA) or die("Cannot load url1a from Scriptcase folder.");
}
else	{
	$url1 = "http://whois.hostingtool.nl/whois_compose_data/index.php?domain=$inputdomain&format=xml&type=1";
	$xml1 = simplexml_load_file($url1b, "SimpleXMLElement", LIBXML_NOCDATA) or die("Cannot load url1b from public_html folder.");
}

$html_text = '<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="robots" content="index"><title>Whois modeling for confirmation</title></head>';
$html_text .= '<body><div style="border-spacing=0; padding=0; border-width=0; padding-bottom:5px; line-height:120%;">
<table style="border-collapse:collapse; font-family:Helvetica, Arial, sans-serif; font-size:13px;">
<tr><th style="width:300px"></th><th style="width:400px"></th></tr>';
$html_text .= '<tr><td><b>Modeling of confirmation to admin_email</b></td><td></td></tr>';
$html_text .= '<tr><td><hr></td><td><hr></td></tr>';
$html_text .= '<tr><td COLSPAN="2">- English version of this message below â€“</td></tr>';
$html_text .= '<tr><td COLSPAN="2"><br />Beste domeinnaamhouder,</td></tr>';
$html_text .= '<tr><td COLSPAN="2"><br />Je krijgt deze mail omdat je de administratieve contactpersoon bent van een domeinnaam.</td></tr>';
$html_text .= '<tr><td COLSPAN="2">team.blue nl B.V. heeft de houder van webhostingtech.nl veranderd. Dit zijn de gegevens:</td></tr>';
foreach ($xml1->xpath('//domain') as $item)	{
	simplexml_load_string($item->asXML());
	$html_text .= '<tr><td COLSPAN="2"><br />Houder / Registrant:</td></tr>';
	$html_text .= '<tr><td>registrant_contact_id</td><td>'.$item->registrant->registrant_contact_id.'</td></tr>';
	$html_text .= '<tr><td>registrant_company_name</td><td>'.$item->registrant->registrant_company_name.'</td></tr>';
	$html_text .= '<tr><td>registrant_personal_name</td><td>'.$item->registrant->registrant_personal_name.'</td></tr>';	
	$html_text .= '<tr><td>registrant_street</td><td>'.$item->registrant->registrant_street.'</td></tr>';
	$html_text .= '<tr><td>registrant_postal_code</td><td>'.$item->registrant->registrant_postal_code.'</td></tr>';
	$html_text .= '<tr><td>registrant_city</td><td>'.$item->registrant->registrant_city.'</td></tr>';
	$html_text .= '<tr><td>registrant_phone</td><td>'.$item->registrant->registrant_phone.'</td></tr>';
	$html_text .= '<tr><td>registrant_email</td><td>'.$item->registrant->registrant_email.'</td></tr>';
	$html_text .= '<tr><td>registrant_country_code</td><td>'.$item->registrant->registrant_country_code.'</td></tr>';
	$html_text .= '<tr><td>registrant_country_name</td><td>'.$item->registrant->registrant_country_name.'</td></tr>';
	$html_text .= '<tr><td>registrant_country_language</td><td>'.$item->registrant->registrant_country_language.'</td></tr>';
	$html_text .= '<tr><td>registrant_protected</td><td>'.$item->registrant->registrant_protected.'</td></tr>';
	$html_text .= '<tr><td COLSPAN="2"><br />Administratieve contactpersoon / Administrative contact:</td></tr>';
	$html_text .= '<tr><td>admin_contact_id</td><td>'.$item->admin->admin_contact_id.'</td></tr>';
	$html_text .= '<tr><td>admin_company_name</td><td>'.$item->admin->admin_company_name.'</td></tr>';
	$html_text .= '<tr><td>admin_personal_name</td><td>'.$item->admin->admin_personal_name.'</td></tr>';
	$html_text .= '<tr><td>admin_phone</td><td>'.$item->admin->admin_phone.'</td></tr>';
	$html_text .= '<tr><td>admin_email</td><td>'.$item->admin->admin_email.'</td></tr>';
	$html_text .= '<tr><td>admin_protected</td><td>'.$item->admin->admin_protected.'</td></tr>';
	$html_text .= '<tr><td COLSPAN="2"><br />Klopt dit volgens jou niet? Neem dan contact op met het bedrijf dat je domeinnaam beheert: team.blue nl B.V. of de reseller: TransIP. Bij fysieke toegang om te wijzigen in Whois, heeft een registrant de primaire verantwoordelijkheid.</td></tr>';
	$html_text .= '<tr><td COLSPAN="2"><br />Met vriendelijke groet,</td></tr>';
	$html_text .= '<tr><td COLSPAN="2">SIDN</td></tr>';
	$html_text .= '<tr><td COLSPAN="2"><br />Beantwoord deze mail niet. Wij krijgen het antwoord namelijk niet binnen. Vragen kun je sturen naar <a href="mailto:support@sidn.nl">support@sidn.nl</a>.</td></tr>';
	$html_text .= '<tr><td><hr></td><td><hr></td></tr>';
	break;
}
$html_text .= '<tr><td COLSPAN="2"><br />Dear registrant,</td></tr>';
$html_text .= '<tr><td COLSPAN="2"><br />You are receiving this message because you are the administrative contact for a domain name.</td></tr>';
$html_text .= '<tr><td COLSPAN="2">team.blue nl B.V. has changed the registrant of webhostingtech.nl, as follows:</td></tr>';
foreach ($xml1->xpath('//domain') as $item)	{
	simplexml_load_string($item->asXML());
	$html_text .= '<tr><td COLSPAN="2"><br />Registrant:</td></tr>';
	$html_text .= '<tr><td>registrant_contact_id</td><td>'.$item->registrant->registrant_contact_id.'</td></tr>';
	$html_text .= '<tr><td>registrant_company_name</td><td>'.$item->registrant->registrant_company_name.'</td></tr>';
	$html_text .= '<tr><td>registrant_personal_name</td><td>'.$item->registrant->registrant_personal_name.'</td></tr>';	
	$html_text .= '<tr><td>registrant_street</td><td>'.$item->registrant->registrant_street.'</td></tr>';
	$html_text .= '<tr><td>registrant_postal_code</td><td>'.$item->registrant->registrant_postal_code.'</td></tr>';
	$html_text .= '<tr><td>registrant_city</td><td>'.$item->registrant->registrant_city.'</td></tr>';
	$html_text .= '<tr><td>registrant_phone</td><td>'.$item->registrant->registrant_phone.'</td></tr>';
	$html_text .= '<tr><td>registrant_email</td><td>'.$item->registrant->registrant_email.'</td></tr>';
	$html_text .= '<tr><td>registrant_country_code</td><td>'.$item->registrant->registrant_country_code.'</td></tr>';
	$html_text .= '<tr><td>registrant_country_name</td><td>'.$item->registrant->registrant_country_name.'</td></tr>';
	$html_text .= '<tr><td>registrant_country_language</td><td>'.$item->registrant->registrant_country_language.'</td></tr>';
	$html_text .= '<tr><td>registrant_protected</td><td>'.$item->registrant->registrant_protected.'</td></tr>';
	$html_text .= '<tr><td COLSPAN="2"><br />Administrative contact:</td></tr>';
	$html_text .= '<tr><td>admin_contact_id</td><td>'.$item->admin->admin_contact_id.'</td></tr>';
	$html_text .= '<tr><td>admin_company_name</td><td>'.$item->admin->admin_company_name.'</td></tr>';
	$html_text .= '<tr><td>admin_personal_name</td><td>'.$item->admin->admin_personal_name.'</td></tr>';
	$html_text .= '<tr><td>admin_phone</td><td>'.$item->admin->admin_phone.'</td></tr>';
	$html_text .= '<tr><td>admin_email</td><td>'.$item->admin->admin_email.'</td></tr>';
	$html_text .= '<tr><td>admin_protected</td><td>'.$item->admin->admin_protected.'</td></tr>';
	$html_text .= '<tr><td COLSPAN="2"><br />If you think that a mistake has been made, please contact the service provider that manages the registration
	(team.blue nl B.V.) or the reseller (TransIP). With physical access to change in Whois, a registrant has primary responsibility.</td></tr>';
	$html_text .= '<tr><td COLSPAN="2"><br />Kind regards</td></tr>';
	$html_text .= '<tr><td COLSPAN="2">SIDN</td></tr>';
	$html_text .= '<tr><td COLSPAN="2"><br />Please don&#39;t reply to this mail. If you have any questions or feedback, please contact <a href="mailto:support@sidn.nl">support@sidn.nl</a>.</td></tr>';
	$html_text .= '<tr><td><hr></td><td><hr></td></tr>';
	break;
}
$html_text .= '</table></div></body></html>';
echo $html_text;
?>